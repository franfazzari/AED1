#include "../definiciones.h"
#include "../Funciones_TPI.h"
#include "../ejercicios.h"
#include "gtest/gtest.h"
#include <iostream>
#include <string>
#include <math.h>

using namespace std;

#define UMBRAL 0.0001

// Caso de división por cero que sea igual a 0
TEST(laCasaEstaQuedandoChicaTEST, todosSinHC) {

//                                                     reg +500 Tipo    Habit
//                                                       v  v   v       v
    eph_h th = {{22114, 2020,   3,  319611, 629088, 3,  1,  0,  1,  3,  2,  2},
                {22866, 2020,   3,  317157, 627217, 2,  40, 0,  1,  2,  3,  2},
                {20957, 2020,   3,  313965, 623297, 1,  41, 0,  1,  3,  3,  2},
                {22110, 2020,   3,  319611, 629088, 3,  42, 0,  1,  3,  4,  2},
                {22111, 2020,   3,  319611, 629088, 3,  43, 0,  1,  3,  4,  2},
                {22112, 2020,   3,  319611, 629088, 3,  44, 0,  1,  3,  3,  2}};

    eph_i ti = {{20957, 2020,   1,  1,  3,  1,  88, 0,  0,  90000,  10},
                {20957, 2020,   2,  1,  3,  2,  82, 0,  0,  25000,  10},
                {20957, 2020,   3,  1,  3,  2,  82, 0,  0,  25000,  10},
                {20957, 2020,   4,  1,  3,  2,  82, 0,  0,  25000,  10},
                {22866, 2020,   1,  0,  3,  1,  31, 1,  3,  59000,  10},
                {22866, 2020,   2,  1,  3,  2,  28, 1,  3,  0,      6},
                {22866, 2020,   3,  1,  3,  2,  28, 1,  3,  0,      6},
                {22866, 2020,   4,  1,  3,  2,  28, 1,  3,  0,      6},
                {22110, 2020,   1,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22110, 2020,   2,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22110, 2020,   3,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22110, 2020,   4,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22114, 2020,   1,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22114, 2020,   2,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22114, 2020,   3,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22114, 2020,   4,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22111, 2020,   1,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22111, 2020,   2,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22111, 2020,   3,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22111, 2020,   4,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22112, 2020,   1,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22112, 2020,   2,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22112, 2020,   3,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22112, 2020,   4,  0,  3,  1,  18, 0,  0,  20000,  10},
    };

    vector<pair<int,float>> esperado = {make_pair(1,0),
                                        make_pair(40, 0),
                                        make_pair(41, 0),
                                        make_pair(42,0),
                                        make_pair(43,0),
                                        make_pair(44,0)};
    vector<pair<int,float>> resultado = laCasaEstaQuedandoChica(th, ti);

    int i=0;
    while( i < 6 ) {
        EXPECT_EQ( esperado[i].first, resultado[i].first );
        EXPECT_EQ( true, flotante_valido(esperado[i].second, resultado[i].second, UMBRAL) );
        i++;
    }
}

TEST(laCasaEstaQuedandoChicaTEST, HCenTodaUnaRegion) {

//                                                    Región\ +500 /Tipo
//                                                       v  v  v
    eph_h th = {{22114, 2020,   3,  319611, 629088, 3,  1,  0,  1,  3,  3,  2},
                {22866, 2020,   3,  317157, 627217, 2,  40, 0,  1,  2,  4,  2},
                {20957, 2020,   3,  313965, 623297, 1,  41, 0,  1,  3,  2,  2},
                {21000, 2020,   3,  313975, 623299, 1,  41, 0,  1,  1,  1,  2},
                {22110, 2020,   3,  319688, 629077, 3,  42, 0,  1,  3,  3,  2},
                {22111, 2020,   3,  319655, 629055, 3,  43, 0,  1,  3,  4,  2},
                {22112, 2020,   3,  319600, 629012, 3,  44, 0,  1,  3,  3,  2}};

    eph_i ti = {{20957, 2020,   1,  1,  3,  1,  88, 0,  0,  90000,  10},
                {20957, 2020,   2,  1,  3,  2,  82, 0,  0,  25000,  10},
                {20957, 2020,   3,  1,  3,  2,  82, 0,  0,  25000,  10},
                {20957, 2020,   4,  1,  3,  2,  82, 0,  0,  25000,  10},
                {20957, 2020,   5,  1,  3,  2,  82, 0,  0,  25000,  10},
                {20957, 2020,   6,  1,  3,  2,  82, 0,  0,  25000,  10},
                {20957, 2020,   7,  1,  3,  2,  82, 0,  0,  25000,  10},
                {20957, 2020,   8,  1,  3,  2,  82, 0,  0,  25000,  10},
                {20957, 2020,   9,  1,  3,  2,  82, 0,  0,  25000,  10},
                {20957, 2020,   10,  1,  3,  2,  82, 0,  0,  25000,  10},
                {22866, 2020,   1,  0,  3,  1,  31, 1,  3,  59000,  10},
                {22866, 2020,   2,  1,  3,  2,  28, 1,  3,  0,      6},
                {22866, 2020,   3,  1,  3,  2,  28, 1,  3,  0,      6},
                {22866, 2020,   4,  1,  3,  2,  28, 1,  3,  0,      6},
                {21000, 2020,   1,  1,  3,  2,  28, 1,  3,  0,      6},
                {21000, 2020,   2,  1,  3,  2,  28, 1,  3,  0,      6},
                {21000, 2020,   3,  1,  3,  2,  28, 1,  3,  0,      6},
                {21000, 2020,   4,  1,  3,  2,  28, 1,  3,  0,      6},
                {22110, 2020,   1,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22110, 2020,   2,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22110, 2020,   3,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22110, 2020,   4,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22114, 2020,   1,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22114, 2020,   2,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22114, 2020,   3,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22114, 2020,   4,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22111, 2020,   1,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22111, 2020,   2,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22111, 2020,   3,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22111, 2020,   4,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22112, 2020,   1,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22112, 2020,   2,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22112, 2020,   3,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22112, 2020,   4,  0,  3,  1,  18, 0,  0,  20000,  10},
    };

    vector<pair<int,float>> esperado = {make_pair(1,0),
                                        make_pair(40, 0),
                                        make_pair(41, 1),
                                        make_pair(42,0),
                                        make_pair(43,0),
                                        make_pair(44,0)};
    vector<pair<int,float>> resultado = laCasaEstaQuedandoChica(th, ti);

    int i=0;
    while( i < 6 ) {
        EXPECT_EQ( esperado[i].first, resultado[i].first );
        EXPECT_EQ( true, flotante_valido(esperado[i].second, resultado[i].second, UMBRAL) );
        i++;
    }
}


TEST(laCasaEstaQuedandoChicaTEST, HCenAlgunosHogares) {

//                                                    Región\ +500 /Tipo
//                                                       v  v  v
    eph_h th = {{22114, 2020,   3,  319611, 629088, 3,  1,  0,  1,  3,  3,  2},
                {22866, 2020,   3,  317157, 627217, 2,  40, 0,  1,  2,  2,  2},
                {20957, 2020,   3,  313965, 623297, 1,  41, 0,  1,  3,  3,  2},
                {22110, 2020,   3,  319611, 629088, 3,  44, 0,  1,  2,  2,  2},
                {22113, 2020,   3,  319611, 629088, 3,  42, 0,  1,  2,  2,  2},
                {22115, 2020,   3,  319611, 629088, 3,  44, 0,  1,  1,  1,  2},
                {22111, 2020,   3,  319611, 629088, 3,  43, 0,  1,  3,  3,  2},
                {22112, 2020,   3,  319611, 629088, 3,  44, 0,  1,  3,  3,  2}};

    eph_i ti = {{20957, 2020,   1,  1,  3,  1,  88, 0,  0,  90000,  10},
                {20957, 2020,   2,  1,  3,  2,  82, 0,  0,  25000,  10},
                {20957, 2020,   3,  1,  3,  2,  82, 0,  0,  25000,  10},
                {20957, 2020,   4,  1,  3,  2,  82, 0,  0,  25000,  10},
                {20957, 2020,   5,  1,  3,  2,  82, 0,  0,  25000,  10},
                {20957, 2020,   6,  1,  3,  2,  82, 0,  0,  25000,  10},
                {20957, 2020,   7,  1,  3,  2,  82, 0,  0,  25000,  10},
                {20957, 2020,   8,  1,  3,  2,  82, 0,  0,  25000,  10},
                {20957, 2020,   9,  1,  3,  2,  82, 0,  0,  25000,  10},
                {20957, 2020,   10,  1,  3,  2,  82, 0,  0,  25000,  10},
                {22866, 2020,   1,  0,  3,  1,  31, 1,  3,  59000,  10},
                {22866, 2020,   2,  1,  3,  2,  28, 1,  3,  0,      6},
                {22866, 2020,   3,  1,  3,  2,  28, 1,  3,  0,      6},
                {22866, 2020,   4,  1,  3,  2,  28, 1,  3,  0,      6},
                {22110, 2020,   1,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22110, 2020,   2,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22110, 2020,   3,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22110, 2020,   4,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22110, 2020,   5,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22110, 2020,   6,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22110, 2020,   7,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22110, 2020,   8,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22114, 2020,   1,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22114, 2020,   2,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22114, 2020,   3,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22114, 2020,   4,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22115, 2020,   1,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22115, 2020,   2,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22115, 2020,   3,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22115, 2020,   4,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22111, 2020,   1,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22111, 2020,   2,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22111, 2020,   3,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22111, 2020,   4,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22112, 2020,   1,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22112, 2020,   2,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22112, 2020,   3,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22112, 2020,   4,  0,  3,  1,  18, 0,  0,  20000,  10},
                {22113, 2020,   1,  0,  3,  1,  18, 0,  0,  20000,  10},
    };

    vector<pair<int,float>> esperado = {make_pair(1,0),
                                        make_pair(40, 0),
                                        make_pair(41, 1),
                                        make_pair(42,0),
                                        make_pair(43,0),
                                        make_pair(44,0.66666)};
    vector<pair<int,float>> resultado = laCasaEstaQuedandoChica(th, ti);

    int i=0;
    while( i < 6 ) {
        EXPECT_EQ( esperado[i].first, resultado[i].first );
        EXPECT_EQ( true, flotante_valido(esperado[i].second, resultado[i].second, UMBRAL) );
        i++;
    }
}


TEST(laCasaEstaQuedandoChicaTEST, HCfaltandoUnaRegion) {

//                                                    Región\ +500 /Tipo
//                                                       v  v  v
eph_h th = {{22114, 2020,   3,  319611, 629088, 3,  1,  0,  1,  3,  3,  2},
            {22866, 2020,   3,  317157, 627217, 2,  40, 0,  1,  2,  2,  2},
            {20957, 2020,   3,  313965, 623297, 1,  41, 0,  1,  3,  3,  2},
            {22110, 2020,   3,  319611, 629088, 3,  41, 0,  1,  2,  2,  2},
            {22111, 2020,   3,  319611, 629088, 3,  43, 0,  1,  3,  3,  2},
            {22112, 2020,   3,  319611, 629088, 3,  44, 0,  1,  3,  3,  2}};

eph_i ti = {{20957, 2020,   1,  1,  3,  1,  88, 0,  0,  90000,  10},
            {20957, 2020,   2,  1,  3,  2,  82, 0,  0,  25000,  10},
            {20957, 2020,   3,  1,  3,  2,  82, 0,  0,  25000,  10},
            {20957, 2020,   4,  1,  3,  2,  82, 0,  0,  25000,  10},
            {20957, 2020,   5,  1,  3,  2,  82, 0,  0,  25000,  10},
            {20957, 2020,   6,  1,  3,  2,  82, 0,  0,  25000,  10},
            {20957, 2020,   7,  1,  3,  2,  82, 0,  0,  25000,  10},
            {20957, 2020,   8,  1,  3,  2,  82, 0,  0,  25000,  10},
            {20957, 2020,   9,  1,  3,  2,  82, 0,  0,  25000,  10},
            {20957, 2020,   10,  1,  3,  2,  82, 0,  0,  25000,  10},
            {22866, 2020,   1,  0,  3,  1,  31, 1,  3,  59000,  10},
            {22866, 2020,   2,  1,  3,  2,  28, 1,  3,  0,      6},
            {22866, 2020,   3,  1,  3,  2,  28, 1,  3,  0,      6},
            {22866, 2020,   4,  1,  3,  2,  28, 1,  3,  0,      6},
            {22110, 2020,   1,  0,  3,  1,  18, 0,  0,  20000,  10},
            {22110, 2020,   2,  0,  3,  1,  18, 0,  0,  20000,  10},
            {22110, 2020,   3,  0,  3,  1,  18, 0,  0,  20000,  10},
            {22110, 2020,   4,  0,  3,  1,  18, 0,  0,  20000,  10},
            {22114, 2020,   1,  0,  3,  1,  18, 0,  0,  20000,  10},
            {22114, 2020,   2,  0,  3,  1,  18, 0,  0,  20000,  10},
            {22114, 2020,   3,  0,  3,  1,  18, 0,  0,  20000,  10},
            {22114, 2020,   4,  0,  3,  1,  18, 0,  0,  20000,  10},
            {22111, 2020,   1,  0,  3,  1,  18, 0,  0,  20000,  10},
            {22111, 2020,   2,  0,  3,  1,  18, 0,  0,  20000,  10},
            {22111, 2020,   3,  0,  3,  1,  18, 0,  0,  20000,  10},
            {22111, 2020,   4,  0,  3,  1,  18, 0,  0,  20000,  10},
            {22112, 2020,   1,  0,  3,  1,  18, 0,  0,  20000,  10},
            {22112, 2020,   2,  0,  3,  1,  18, 0,  0,  20000,  10},
            {22112, 2020,   3,  0,  3,  1,  18, 0,  0,  20000,  10},
            {22112, 2020,   4,  0,  3,  1,  18, 0,  0,  20000,  10},
};

vector<pair<int,float>> esperado = {make_pair(1,0),
                                    make_pair(40, 0),
                                    make_pair(41, 0.5),
                                    make_pair(42,0),
                                    make_pair(43,0),
                                    make_pair(44,0)};
vector<pair<int,float>> resultado = laCasaEstaQuedandoChica(th, ti);

int i=0;
while( i < 6 ) {
EXPECT_EQ( esperado[i].first, resultado[i].first );
EXPECT_EQ( true, flotante_valido(esperado[i].second, resultado[i].second, UMBRAL) );
i++;
}
}
